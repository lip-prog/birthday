<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" type="image/png" href="../src/icon.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Happy Birthday</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- MediaPipe Hands -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.6.1629159505/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
    
</head>
<body>
    
<div id="debug-console"></div>

<div id="protocol-warning">
    ⚠️ 检测到您直接打开了HTML文件 (file://)。<br>摄像头和麦克风将被拦截。<br>
    <b>请在 VS Code 中安装 "Live Server" 插件并使用 "Open with Live Server" 运行。</b>
</div>

<audio id="bgm" loop>
    <source src="./src/Beautiful.mp3" type="audio/mpeg">
</audio>

<video class="input_video" playsinline></video>
<div id="canvas-container"></div>

<button id="floating-gift-btn" class="hidden safe-click-area" title="查看祝福">🎁</button>

<!-- 启动页 -->
<div id="start-overlay">
    <div class="text-center max-w-md p-8 glass-panel start-card mx-4 animate-float">
        <h1 class="text-6xl mb-2 font-handwriting text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-purple-400 drop-shadow-lg">Happy Birthday</h1>
        <!-- <h2 class="text-4xl mb-6 font-bold text-white tracking-widest neon-text">粉姐</h2> -->
        <div class="space-y-4 text-gray-200 text-lg mb-8 font-light">
            <p>👋 <b>对着镜头 举起双手</b> 唤醒魔法</p>
            <p>💨 <b>持续吹气</b> 许下心愿</p>
        </div>
        <button id="start-btn" class="safe-click-area px-12 py-4 bg-gradient-to-r from-pink-600 to-purple-700 rounded-full font-bold text-xl hover:scale-105 active:scale-95 transition transform shadow-[0_0_20px_rgba(255,105,180,0.5)] text-white border border-white/20 cursor-pointer z-50">
            进入魔法世界
        </button>
        <div id="loading-text" class="hidden mt-4 text-pink-300 text-sm">正在编织星光...</div>
    </div>
</div>

<div id="blow-hint"><p class="text-lg font-bold text-pink-200 mb-1">🎤 对着麦克风吹气</p><p class="text-xs text-gray-400">(如果麦克风不灵可以尝试电脑长按空格 · 手机长按屏幕)</p></div>
<div id="blow-meter-container"><div id="blow-meter-bar"></div></div>

<div id="top-banner" class="hidden">
    <h1 class="text-6xl md:text-8xl banner-text">Happy Birthday</h1>
    <p class="text-pink-200/70 text-lg mt-2 tracking-widest uppercase">Best Wishes for You</p>
</div>

<!-- UI 层 -->
<div id="ui-layer" style="display: none;">
    <div class="flex justify-between items-start w-full">
        <div class="glass-panel px-4 py-2">
            <div id="status-dot" class="inline-block w-2 h-2 rounded-full bg-red-500 mr-2 shadow-[0_0_8px_red]"></div>
            <span id="status-text" class="text-xs md:text-sm text-gray-300 tracking-wider">SYSTEM READY</span>
        </div>
        <div class="flex gap-2">
            <button id="settings-toggle" class="interactive-element p-3 glass-panel hover:bg-white/20 transition rounded-full active:scale-90 text-sm">🎨</button>
            <button id="music-btn" class="interactive-element p-3 glass-panel hover:bg-white/20 transition rounded-full active:scale-90">🎵</button>
        </div>
    </div>
    
    <div id="settings-panel">
        <div class="color-control"><span>底层颜色</span><input type="color" id="picker-bottom" value="#FF69B4"></div>
        <div class="color-control"><span>顶层颜色</span><input type="color" id="picker-top" value="#FFB6C1"></div>
        <div class="color-control"><span>奶油颜色</span><input type="color" id="picker-cream" value="#FFFFFF"></div>
    </div>

    <div id="center-instruction" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center pointer-events-none w-full z-0">
        <div class="flex items-center justify-center gap-4 mb-2">
            <span id="hand-icon" class="text-6xl animate-bounce">👋</span>
            <h2 id="instruction-text" class="text-6xl md:text-8xl font-bold text-white neon-pulse transition-all duration-700">举起双手</h2>
        </div>
        <p id="sub-instruction" class="mt-4 text-xl md:text-2xl text-pink-200/80 font-light tracking-[0.3em]">让魔法发生</p>
        <!-- 自动倒数提示文字 -->
        <p id="auto-countdown-text" class="mt-4 text-sm text-pink-200/60 font-light tracking-wider animate-pulse hidden"></p>
    </div>

    <!-- 摄像头预览框 -->
    <div id="cam-preview-container" class="absolute bottom-6 left-6 z-50 opacity-90 hover:opacity-100">
        <div class="glass-panel p-2 rounded-xl border border-white/10 shadow-[0_8px_32px_rgba(0,0,0,0.5)]">
            <div class="relative w-36 h-28 bg-black/40 rounded-lg overflow-hidden border border-white/5">
                    <canvas id="output_canvas" width="160" height="120" class="w-full h-full object-cover transform scale-x-[-1]"></canvas>
                    <div class="absolute top-2 right-2 flex items-center gap-1 bg-black/60 px-1.5 py-0.5 rounded-full backdrop-blur-sm">
                    <div id="cam-status-dot" class="w-1.5 h-1.5 rounded-full bg-red-500 transition-colors duration-300"></div>
                    <span id="cam-status-text" class="text-[8px] text-red-400 font-mono">NO HAND</span>
                    </div>
            </div>
            <div class="text-center mt-1.5">
                <p class="text-[10px] text-pink-200/70 tracking-widest uppercase scale-90">Camera View</p>
            </div>
        </div>
    </div>
</div>

<!-- 惊喜层 -->
<div id="surprise-layer" class="hidden">
    <button id="reveal-btn" class="safe-click-area hidden px-10 py-5 bg-white text-pink-600 rounded-full font-bold text-2xl shadow-[0_0_60px_rgba(255,105,180,0.8)] hover:scale-105 transition-transform duration-300 animate-float">🎁 打开礼物</button>
    
    <!-- 卡片容器 -->
    <div id="flip-card-container" class="hidden flip-card w-full max-w-sm md:max-w-md aspect-[3/4] mx-6 pop-in">
        <div class="flip-card-inner">
            
            <!-- 正面：引导开启 -->
            <div class="flip-card-front glass-panel bg-gradient-to-br from-pink-500/40 to-purple-600/40 border border-white/30 p-1">
                <div class="bg-black/80 rounded-[1rem] p-6 h-full flex flex-col backdrop-blur-md">
                    <div class="w-full aspect-[4/3] bg-gray-800 rounded-lg mb-6 overflow-hidden relative border border-white/10 shadow-inner">
                        <img src="https://bpic.588ku.com/Templet_origin_pic/05/19/43/8c971b1364922e551b4fbccb2d5719d2.jpg" class="w-full h-full object-cover" alt="Gift">
                        <div class="absolute bottom-3 left-4 text-white/90 font-handwriting text-2xl">Happy Birthday!</div>
                    </div>
                    <div class="text-center mt-auto mb-8">
                        <p class="text-gray-300 mb-6 font-light leading-relaxed">这不仅仅是一场数字烟花<br>更是为你准备的专属时刻。</p>
                        <button id="next-surprise-btn" class="safe-click-area w-full py-3 bg-gradient-to-r from-pink-600 to-purple-700 rounded-xl font-bold text-white shadow-lg hover:brightness-110 active:scale-95 transition">What's the surprise? ✨</button>
                    </div>
                </div>
            </div>

            <!-- 背面：祝福内容 (分页显示) -->
            <div class="flip-card-back glass-panel bg-gradient-to-br from-purple-500/40 to-blue-600/40 border border-white/30 p-1">
                <div class="bg-black/90 rounded-[1rem] p-8 h-full flex flex-col items-center justify-center backdrop-blur-md">
                    
                    <!-- 第一页：生日祝福 (带照片) -->
                    <div id="card-page-1" class="w-full h-full flex flex-col">
                        <div class="mb-4 text-5xl animate-bounce text-center">💌</div>
                        <h3 class="text-2xl font-bold text-pink-300 mb-6 font-handwriting text-center">致最特别的你</h3>
                        <div id="typewriter-text-1" class="text-left text-gray-200 space-y-4 font-light leading-7 text-sm md:text-base border-l-2 border-pink-500/50 pl-4 mb-4 flex-grow scrollable-text"></div>
                        
                        <button id="to-page-2-btn" class="safe-click-area px-6 py-2 mt-auto rounded-full bg-white/10 text-pink-200 hover:bg-white/20 transition text-sm flex items-center justify-center mx-auto">
                            还有话对你说... <span class="ml-2">👉</span>
                        </button>
                    </div>

                    <!-- 第二页：快递信息 (纯文字，带滚动) -->
                    <div id="card-page-2" class="w-full h-full flex flex-col hidden">
                        <h3 class="text-xl font-bold text-purple-300 mb-4 font-handwriting text-center mt-2">🎁礼物领取任务卡</h3>
                        <!-- 滚动区域 -->
                        <div id="typewriter-text-2" class="text-left text-gray-200 space-y-3 font-light leading-6 text-sm md:text-base border-l-2 border-purple-500/50 pl-4 mb-4 flex-grow scrollable-text h-full"></div>
                        
                        <button id="close-card-btn" class="safe-click-area px-8 py-2 mt-auto rounded-full border border-white/30 text-gray-300 hover:bg-white/10 hover:text-white transition text-sm mx-auto">
                            收起卡片
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
